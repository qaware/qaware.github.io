<!doctype html><html lang=en><head><title>Collaborative Monitoring - QAware | Software Engineering Blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=yes"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=description content="We found a helpful approach to collaborative monitoring in a large project that we want to share with you."><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="Collaborative Monitoring"><meta property="og:description" content="We found a helpful approach to collaborative monitoring in a large project that we want to share with you."><meta property="og:url" content="https://blog.qaware.de/posts/collaborative-monitoring/"><meta property="og:image" content="https://blog.qaware.de/images/collaborative-monitoring-title.png"><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><link rel=apple-touch-icon sizes=57x57 href=/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json crossorigin=use-credentials><link rel=icon href=/QAware_Logo_Icon_RGB_Petrol.svg type=image/svg+xml><meta name=msapplication-TileColor content="#ffffff"><meta name=msapplication-TileImage content="/ms-icon-144x144.png"><meta name=theme-color content="#ffffff"><link rel=canonical href=https://blog.qaware.de/posts/collaborative-monitoring/><link rel=stylesheet href=https://blog.qaware.de/css/main.098c0e189cad2e9f36cf297e63d68287a9f1e1ba37b72c316aafe78722aca094738d3238a359d91fca3eb48fc356b73c7e436c50fac13d61ddfa699fca90005d.css integrity='sha512-CYwOGJytLp82zyl+Y9aCh6nx4bo3tywxaq/nhyKsoJRzjTI4o1nZH8o+tI/DVrc8fkNsUPrBPWHd+mmfypAAXQ==' title=templateStyle><script id=Cookiebot src=https://consent.cookiebot.com/uc.js data-cbid=4e938949-aa56-465e-9c2a-175bb6c31d81 data-blockingmode=auto type=text/javascript></script></head><body><header><div id=main-header><a href=/ id=main-header-logo><img src=/images/icons/logo_qaware.svg alt=QAware id=main-header-logo-img></a><div id=main-header-nav-items-container><nav id=main-nav><ul class=main-nav-menu><li class=main-nav-menu><a href=https://blog.qaware.de/ class="main-nav-menu nav-item">Posts</a><ul class=main-nav-sub-menu><li class=main-nav-sub-menu><a href=https://blog.qaware.de/tags/ class="main-nav-sub-menu nav-item">Tags</a></li><li class=main-nav-sub-menu><a href=https://blog.qaware.de/posts/ class="main-nav-sub-menu nav-item">Archive</a></li></ul></li><li class=main-nav-menu><a href=https://blog.qaware.de/ class="main-nav-menu nav-item">Resources</a><ul class=main-nav-sub-menu><li class=main-nav-sub-menu><a href=https://www.github.com/qaware class=main-nav-sub-menu>GitHub</a></li><li class=main-nav-sub-menu><a href=https://de.slideshare.net/QAware class=main-nav-sub-menu>SlideShare</a></li><li class=main-nav-sub-menu><a href=https://www.youtube.com/user/QAwareGmbH class=main-nav-sub-menu>YouTube</a></li><li class=main-nav-sub-menu><a href=https://www.meetup.com/de-DE/Cloud-Native-Night class=main-nav-sub-menu>Meetup Mainz</a></li><li class=main-nav-sub-menu><a href=https://www.meetup.com/de-DE/cloud-native-muc/ class=main-nav-sub-menu>Meetup Munich</a></li></ul></li><li class=main-nav-menu><a href=https://www.qaware.de class=main-nav-menu>Company</a><ul class=main-nav-sub-menu><li class=main-nav-sub-menu><a href=https://www.qaware.de class=main-nav-sub-menu>Website</a></li><li class=main-nav-sub-menu><a href=https://twitter.com/qaware class=main-nav-sub-menu>Twitter</a></li><li class=main-nav-sub-menu><a href=http://www.linkedin.com/company/qaware-gmbh class=main-nav-sub-menu>Linkedin</a></li><li class=main-nav-sub-menu><a href=http://www.xing.com/companies/qawaregmbh class=main-nav-sub-menu>Xing</a></li><li class=main-nav-sub-menu><a href=http://www.kununu.com/qaware class=main-nav-sub-menu>Kununu</a></li></ul></li><li class=main-nav-menu><a href=https://www.qaware.de/kontakt class=main-nav-menu>Contact</a></li></ul></nav><a id=mobile-nav-icon-link href=#><div id=mobile-nav-icon></div></a></div></div><div id=mobile-nav-dropdown><nav id=mobile-nav class="mobile-nav collapsed"><ul><li><a href=https://blog.qaware.de/ class=nav-item>Posts</a><ul><li><a href=https://blog.qaware.de/tags/ class=nav-item>Tags</a></li><li><a href=https://blog.qaware.de/posts/ class=nav-item>Archive</a></li></ul></li><li><a href=https://blog.qaware.de/ class=nav-item>Resources</a><ul><li><a href=https://www.github.com/qaware>GitHub</a></li><li><a href=https://de.slideshare.net/QAware>SlideShare</a></li><li><a href=https://www.youtube.com/user/QAwareGmbH>YouTube</a></li><li><a href=https://www.meetup.com/de-DE/Cloud-Native-Night>Meetup Mainz</a></li><li><a href=https://www.meetup.com/de-DE/cloud-native-muc/>Meetup Munich</a></li></ul></li><li><a href=https://www.qaware.de class=nav-item>Company</a><ul><li><a href=https://www.qaware.de>Website</a></li><li><a href=https://twitter.com/qaware>Twitter</a></li><li><a href=http://www.linkedin.com/company/qaware-gmbh>Linkedin</a></li><li><a href=http://www.xing.com/companies/qawaregmbh>Xing</a></li><li><a href=http://www.kununu.com/qaware>Kununu</a></li></ul></li><li><a href=https://www.qaware.de/kontakt class=nav-item>Contact</a></li></ul></nav></div></header><main><div class='wrap mt-4 post'><div><p class='post_date pale'>10. July 2020</p><h1 class=post_title>Collaborative Monitoring</h1><p class=pale>by <a href=https://www.linkedin.com/in/florian-lautenschlager-51a299b2/>Florian Lautenschlager</a> | 1189 words | ~6 min read</p><p><a class=post_tag href=/tags/diagnosibility/>diagnosibility</a>
<a class=post_tag href=/tags/devops/>devops</a>
<a class=post_tag href=/tags/observability/>observability</a>
<a class=post_tag href=/tags/collaborative-monitoring/>collaborative monitoring</a>
<a class=post_tag href=/tags/logging/>logging</a>
<a class=post_tag href=/tags/tracing/>tracing</a>
<a class=post_tag href=/tags/metrics/>metrics</a></p><div class=post_body><div class=post_inner><img src=https://blog.qaware.de/images/collaborative-monitoring-title.png alt=collaborative-monitoring-title.png class='post_thumbnail mt-1'><h2 id=background>Background</h2><p>Fortunately, we were able to develop a new large project. In this project there are various different teams that use different programming languages and the expertise of different team members varies. We developed the backend that other developers, testers etc. use to call skills. Typically, a hardware client sends voice commands to the backend, which are processed and the requested skill is called (see Fig. 1).</p><figure><img src=/images/collaborative-monitoring-overview.jpg alt='Overview of our application'><figcaption><p>Figure 1: Overview of our application.</p></figcaption></figure><h2 id=technologies-and-monitoring-toolchain>Technologies and Monitoring Toolchain</h2><p>The software system is developed with a classical microservice architecture and cloud-native technologies. The backend is developed using Spring Boot, the skills using Python. Everything is packed into Docker containers and run within Kubernetes on Azure. To analyse this software system we instrumented our services and skills with Zipkin for distributed tracing and with Prometheus and Grafana for analysing metrics. Logs are written structured (JSON), collected with Fluentd, stored in Elasticsearch and analysed in Kibana.</p><figure><img src=/images/collaborative-monitoring-toolchain.png alt='Toolchain for collecting metrics, events and traces.'><figcaption><p>Figure 2: Toolchain for collecting metrics, events and traces.</p></figcaption></figure><h2 id=motivation>Motivation</h2><p>Very early, people started asking what happend if a skill-invoke or -response might not work out. Although we already offer the above mentioned means, skill-developers, QA-Team etc. do not use the toolchain. After a while we came up with a three step approach, that we call collaborative monitoring (see Figure 3).</p><h2 id=collaborative-monitoring>Collaborative Monitoring</h2><figure><img src=/images/collaborative-monitoring-steps-collaborative-monitoring.png alt='Three steps to enable Collaborative Monitoring'><figcaption><p>Figure 3: Three steps to enable Collaborative Monitoring</p></figcaption></figure><p>The first step (standardise metrics, logs and traces) ensures that the important and necessary information to understand the software systems behaviour is collected respecting certain guidelines. In the second step we combine the metrics, events (log-messages) and traces whereby the guidelines are an important basic building block. The third step integrates the tools to analyse the metrics (Prometheus + Grafana), events (Elasticsearch + Kibana) and traces (Zipkin-Server) in the daily tools developers or testers use, for example a chatbot.</p><p>We have observed that these three steps lead to intensive use of the tool chain, especially the last one. In the following we are going to describe these three steps.</p><h2 id=step-1-standardise-metric-names-contextual-logging-combine-logs-and-traces>Step 1: Standardise Metric Names, Contextual Logging, Combine Logs and Traces</h2><p>To simplify the work with metrics, logs and traces we defined some guidelines, e.g. how to name metrics for outgoing calls, the minimal required fields in a log entry or how to name the tags of a span. This allows us to reuse dashboards and predefined queries for logs or traces. Furthermore, we could ensure that all the necessary information is gathered, like tenant label on outgoing and incoming calls as well as traceId and userId on logs. As an example, we introduced an annotation that developers must use if they want to collect metrics for database calls or to enrich the span information (see Listing 1).</p><figure><img src=/images/collaborative-monitoring-standardise.png alt='Annotation to collect database call durations and expose them as metric and span information.'><figcaption><p>Listing 1: Annotation to collect database call durations and expose them as metric and span information.</p></figcaption></figure><h2 id=step-2-link-and-combine-metrics-events-and-traces>Step 2: Link and combine Metrics, Events and Traces</h2><p>In general, monitoring is either event- or sampling-based. Our toolchain collects metrics sampling-based (as the most other tools do). On the other hand, logs (events) and traces are collected based on events. Hence, we can not easily combine metrics (sampling-based) with traces and logs (event-based).</p><p><strong>Combine Metrics with Traces and Logs (Events):</strong> One can combine them using the timeline. In order to do this, every metric, trace and log needs a timestamp indicating when it was gathered. Even if these timestamps are not aligned in time, we can combine them vaguely.</p><p><strong>Combine Traces and Logs:</strong> One can combine traces and logs sharing the same context, e.g. the userId, tenant, traceId or spanId. This context is stored in the tags of a span and as fields in a log entry. Based on this, we can easily find all logs for a specific trace, using the traceId or all traces of a user by the userId (see also contextual logging). For example, we implemented an <code>AbstracJsonProvider</code> for logback that reads the context out of the mapped diagnostics context of the log-event. If present, it writes each context entry as JSON field (see Listing 2).</p><figure><img src=/images/collaborative-monitoring-contextuallogging.png alt='Contextual logging using a JSON provider for logback.'><figcaption><p>Listing 2: Contextual logging using a JSON provider for logback.</p></figcaption></figure><h2 id=step-3-integrate-metrics-events-and-traces-into-everyones-tools>Step 3: Integrate Metrics, Events and Traces into Everyones Tools</h2><p>In the last step, which is very important, one has to integrate the toolchain into the tools everyone uses. In our example (without the integration) an ordinary developer can look into four different tools to analyse the data and still it&rsquo;s not clear how to combine the information. Consequently, in nearly all cases an expert has to answer simple questions and becomes more and more first-level support for monitoring concerns.</p><p>In our case almost all teams use Mattermost for communication, e.g. to talk about problems, new features or just about the weather and a five minute workout. It was obvious to integrate the tool chain into Mattermost. We already had a chatbot to communicate with the application, e.g. to ask how the weather will be (what is the typical usage). Figure 4 shows an example.</p><figure><img src=/images/collaborative-monitoring-chatbot.png alt='Chatbot to interact with the application'><figcaption><p>Figure 4: Chatbot to interact with the application, e.g. asking for the weather in Hamburg. With the special field verbose, the Chatbot also provides links to the trace and the logs of the specific request.</p></figcaption></figure><p>In case of an error or if the user provided the verbose flag, the Chatbot links the request to the collected trace and the logs. This is an easy integration that ordinary developers accept. Furthermore, they can analyse their problem on their own and feel like Superman =). We do not only integrate the traces and the logs, we also provide information about the health of the application in terms of health-checks and e2e test results, as the Figure 5 shows. The links in the response directly point into the Grafana dashboard. The latter links into the logs, where a developer can find the corresponding traceIds (see Figure 6).</p><figure><img src=/images/collaborative-monitoring-e2e-test.png alt='Integration of health-checks and e2e test result in the Chatbot.'><figcaption><p>Figure 5: Integration of health-checks and e2e test result in the Chatbot.</p></figcaption></figure><figure><img src=/images/collaborative-monitoring-e2e-grafana.png alt='e2e test analysis in Grafana'><figcaption><p>Figure 6: e2e test analysis in Grafana. A link jumps into the logs of the e2e test, where a developer can find the traceIds.</p></figcaption></figure><h2 id=final-remarks>Final Remarks</h2><p>We found out that collaborative monitoring is a helpful mean for a better usage of our monitoring toolchain. The feedback within the project is really good and the operations team also wants to integrate the toolchain into their custom first-level support application. Furthermore, collaborative monitoring leads to a clear communication between different teams (backend / frontend developers) using the context, e.g. the traceId of an erroneous request. It is standard that ticket issuer always provide the traceId, with which the developers can easily understand the software systems behaviour in terms of logs and traces. They can also combine metrics with the requests by time.</p><p>In summary, we found the approach so good that we would like to share it with you. Hope you enjoyed!</p><p><a href=https://www.linkedin.com/in/florian-lautenschlager-51a299b2/>Florian Lautenschlager</a> and <a href=https://www.linkedin.com/in/fuchshuber/>Josef Fuchshuber</a> in cooperation with <a href=https://www.linkedin.com/in/robert-cloudnative>Robert Hoffmann</a>.</p><hr><p>We also presented these ideas at Container Days 2018. You will find our slides on slideshare: <a href=https://de.slideshare.net/QAware/observability-in-action-the-wild>https://de.slideshare.net/QAware/observability-in-action-the-wild</a></p><figure><a href=//www.slideshare.net/QAware/observability-in-action-the-wild target=_blank><img src=/images/collaborative-monitoring/observability-in-action-the-wild.jpg alt='Observability in a̶c̶t̶i̶o̶n̶! the wild!'></a><figcaption><p><a href=//www.slideshare.net/QAware/observability-in-action-the-wild target=_blank>Observability in a̶c̶t̶i̶o̶n̶! the wild!</a> von <a href=https://www.slideshare.net/QAware target=_blank>QAware GmbH</a></p></figcaption></figure><hr><p>Our talk @ <a href=https://www.meetup.com/de-DE/cloud-native-muc/>Cloud Native Night Meetup</a></p><h3 id=video>Video</h3><div class=video><iframe src='https://www.youtube-nocookie.com/embed/6Bft69-cJsM?controls=1&rel=0'></iframe></div><h3 id=slides>Slides</h3><figure><a href=//www.slideshare.net/QAware/from-zero-to-useless-to-hero-make-runtime-data-useful-in-teams-observability target=_blank><img src=/images/collaborative-monitoring/from-zero-to-useless-to-hero-make-runtime-data-useful-in-teams-observability.jpg alt='From Zero to Useless to Hero – Make Runtime Data Useful in Teams (Observability)'></a><figcaption><p><a href=//www.slideshare.net/QAware/from-zero-to-useless-to-hero-make-runtime-data-useful-in-teams-observability target=_blank>From Zero to Useless to Hero – Make Runtime Data Useful in Teams (Observability)</a> von <a href=https://www.slideshare.net/QAware target=_blank>QAware GmbH</a></p></figcaption></figure></div><div class='post_extra mb-2'><div class='share copy'></div><a href="http://twitter.com/share?text=Check out this post on the QAware Engineering Blog about Collaborative%20Monitoring&url=https%3a%2f%2fblog.qaware.de%2fposts%2fcollaborative-monitoring%2f&hashtags=Diagnosibility%2cDevOps%2cObservability%2cCollaborativeMonitoring%2cLogging%2cTracing%2cMetrics"><div class='share twitter'></div></a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3a%2f%2fblog.qaware.de%2fposts%2fcollaborative-monitoring%2f"><div class='share linkedin'></div></a><a href="mailto:?subject=Collaborative%20Monitoring&body=Hi,%0D%0A%0D%0ACheck out this post on the QAware Engineering Blog: https%3a%2f%2fblog.qaware.de%2fposts%2fcollaborative-monitoring%2f%0D%0A%0D%0ABest Regards"><div class='share email'></div></a></div><div></div></div></div></div><a href=https://blog.qaware.de/ class=post_nav><span class=post_next>The Latest Posts</span></a></main><footer><div class=footer-container><div class=short-link-area><div class=margin><div class=logo-qaware><a href=/><img src=/images/icons/logo-qaware-white.png alt=QAware width=195 height=43></a></div><div class=clr></div><div class=footer-links><a href=https://www.qaware.de/newsbereich/ class=foot-single-link>News</a>
<a href=https://www.qaware.de/eventkalender/ class=foot-single-link>Eventkalender</a>
<a href=https://www.qaware.de/kontakt/ class=foot-single-link>Kontakt</a><div class=footer-table><a href=https://info.qaware.de/en/legal-notice class="foot-single-link footer-table-cell">Legal Notice</a>&nbsp;|&nbsp;
<a href=https://info.qaware.de/en/legal-notice class="foot-single-link footer-table-cell">Privacy</a></div></div><nav class=nav-social><ul class=e-social id=c1375><li><a href=http://www.kununu.com/qaware title=Kununu target=_blank class="icon icon-kununu-outline"><span></span></a></li><li><a href=https://www.twitter.com/qaware title=Twitter target=_blank class="icon icon-twitter-outline"><span></span></a></li><li><a href=https://www.linkedin.com/company/qaware-gmbh title=LinkedIn target=_blank class="icon icon-linkedin-outline"><span></span></a></li><li><a href=https://github.com/qaware title=GitHub target=_blank class="icon icon-git-outline"><span></span></a></li><li><a href=https://www.slideshare.net/qaware title=SlideShare target=_blank class="icon icon-slideshare-outline"><span></span></a></li><li><a href=https://www.youtube.com/channel/UCmNf72xADnO57idipq9jvMg title=Youtube target=_blank class="icon icon-youtube-outline"><span></span></a></li></ul></nav><div class=clr></div></div></div><nav class="footer-nav nav-area"><ul class=margin><li><a href=https://www.qaware.de/leistung/>Leistung</a><ul><li><a href=https://www.qaware.de/leistung/#diagnose>Diagnose</a></li><li><a href=https://www.qaware.de/leistung/#sanierung>Sanierung</a></li><li><a href=https://www.qaware.de/leistung/#leistung-exploration>Exploration</a></li><li><a href=https://www.qaware.de/leistung/#leistung-realisierung>Realisierung</a></li><li><a href=https://www.qaware.de/leistung/#kunden>Referenzen</a></li></ul></li><li><a href=https://www.qaware.de/karriere/>Karriere</a><ul><li><a href=https://www.qaware.de/karriere/#arbeitsplatz>Arbeitsplatz</a></li><li><a href=https://www.qaware.de/karriere/#kultur>Kultur</a></li><li><a href=https://www.qaware.de/karriere/#entwicklung>Entwicklung</a></li><li><a href=https://www.qaware.de/karriere/#weiterbildung>Weiterbildung</a></li><li><a href=https://www.qaware.de/karriere/#jobs>Jobs</a></li><li><a href=https://www.qaware.de/karriere/#veranstaltungen>Veranstaltungen</a></li></ul></li><li><a href=https://www.qaware.de/wissen/>Wissen</a><ul><li><a href=https://www.qaware.de/wissen/#manifest>Manifest</a></li><li><a href=https://www.qaware.de/wissen/#blog>Blog</a></li><li><a href=https://www.qaware.de/wissen/#konferenzen>Konferenzen</a></li><li><a href=https://www.qaware.de/wissen/#fachartikel>Fachartikel</a></li><li><a href=https://www.qaware.de/wissen/#buecher>Bücher</a></li><li><a href=https://www.qaware.de/wissen/#vorlesungen>Vorlesungen</a></li><li><a href=https://www.qaware.de/wissen/#forschung>Forschung</a></li></ul></li><li><a href=https://www.qaware.de/unternehmen/>Unternehmen</a><ul><li><a href=https://www.qaware.de/unternehmen/#unternehmenskultur>Mission</a></li><li><a href=https://www.qaware.de/unternehmen/#kennzahlen>Kennzahlen</a></li><li><a href=https://www.qaware.de/unternehmen/#management>Management</a></li></ul></li></ul></nav></div></footer><script src=https://blog.qaware.de/js/index.min.791bb653c336adab277d58e8a52b9e81250276bb14f8fced435ae89f02d3155ae233664425075d8cb7ef5444d08a4a2276ee6bf16082d57c12c85f010e25412a.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-45534590-1"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-45534590-1")</script></body></html>