<!doctype html><html lang=en><head><title>Binary Data Format Comparison - QAware | Software Engineering Blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=yes"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=description content="A comparison of different binary data formats in terms of read/write performance and storage usage."><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="Binary Data Format Comparison"><meta property="og:description" content="A comparison of different binary data formats in terms of read/write performance and storage usage."><meta property="og:url" content="https://blog.qaware.de/posts/binary-data-format-comparison/"><meta property="og:image" content="https://blog.qaware.de/images/binary-data-format-comparison/title.jpg"><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><link rel=apple-touch-icon sizes=57x57 href=/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json crossorigin=use-credentials><link rel=icon href=/QAware_Logo_Icon_RGB_Petrol.svg type=image/svg+xml><meta name=msapplication-TileColor content="#ffffff"><meta name=msapplication-TileImage content="/ms-icon-144x144.png"><meta name=theme-color content="#ffffff"><link rel=canonical href=https://blog.qaware.de/posts/binary-data-format-comparison/><link rel=stylesheet href=https://blog.qaware.de/css/main.d6f73e4ceed166763b77e6ae4748dae9ad47198cedbf1a4fc474c78a007dbf47d6dee613baf3572eedb6eece647a608333945bf28218018eb8455db0c1399674.css integrity='sha512-1vc+TO7RZnY7d+auR0ja6a1HGYztvxpPxHTHigB9v0fW3uYTuvNXLu227s5kemCDM5Rb8oIYAY64RV2wwTmWdA==' title=templateStyle><script id=Cookiebot src=https://consent.cookiebot.com/uc.js data-cbid=4e938949-aa56-465e-9c2a-175bb6c31d81 data-blockingmode=auto type=text/javascript></script></head><body><header><div id=main-header><a href=/ id=main-header-logo><img src=/images/icons/logo_qaware.svg alt=QAware id=main-header-logo-img></a><div id=main-header-nav-items-container><nav id=main-nav><ul class=main-nav-menu><li class=main-nav-menu><a href=https://blog.qaware.de/ class="main-nav-menu nav-item">Posts</a><ul class=main-nav-sub-menu><li class=main-nav-sub-menu><a href=https://blog.qaware.de/tags/ class="main-nav-sub-menu nav-item">Tags</a></li><li class=main-nav-sub-menu><a href=https://blog.qaware.de/posts/ class="main-nav-sub-menu nav-item">Archive</a></li></ul></li><li class=main-nav-menu><a href=https://blog.qaware.de/ class="main-nav-menu nav-item">Resources</a><ul class=main-nav-sub-menu><li class=main-nav-sub-menu><a href=https://www.github.com/qaware class=main-nav-sub-menu>GitHub</a></li><li class=main-nav-sub-menu><a href=https://de.slideshare.net/QAware class=main-nav-sub-menu>SlideShare</a></li><li class=main-nav-sub-menu><a href=https://www.youtube.com/user/QAwareGmbH class=main-nav-sub-menu>YouTube</a></li><li class=main-nav-sub-menu><a href=https://www.meetup.com/de-DE/Cloud-Native-Night class=main-nav-sub-menu>Meetup Mainz</a></li><li class=main-nav-sub-menu><a href=https://www.meetup.com/de-DE/cloud-native-muc/ class=main-nav-sub-menu>Meetup Munich</a></li></ul></li><li class=main-nav-menu><a href=https://www.qaware.de class=main-nav-menu>Company</a><ul class=main-nav-sub-menu><li class=main-nav-sub-menu><a href=https://www.qaware.de class=main-nav-sub-menu>Website</a></li><li class=main-nav-sub-menu><a href=https://twitter.com/qaware class=main-nav-sub-menu>Twitter</a></li><li class=main-nav-sub-menu><a href=http://www.linkedin.com/company/qaware-gmbh class=main-nav-sub-menu>Linkedin</a></li><li class=main-nav-sub-menu><a href=http://www.xing.com/companies/qawaregmbh class=main-nav-sub-menu>Xing</a></li><li class=main-nav-sub-menu><a href=http://www.kununu.com/qaware class=main-nav-sub-menu>Kununu</a></li></ul></li><li class=main-nav-menu><a href=https://www.qaware.de/kontakt class=main-nav-menu>Contact</a></li></ul></nav><a id=mobile-nav-icon-link href=#><div id=mobile-nav-icon></div></a></div></div><div id=mobile-nav-dropdown><nav id=mobile-nav class="mobile-nav collapsed"><ul><li><a href=https://blog.qaware.de/ class=nav-item>Posts</a><ul><li><a href=https://blog.qaware.de/tags/ class=nav-item>Tags</a></li><li><a href=https://blog.qaware.de/posts/ class=nav-item>Archive</a></li></ul></li><li><a href=https://blog.qaware.de/ class=nav-item>Resources</a><ul><li><a href=https://www.github.com/qaware>GitHub</a></li><li><a href=https://de.slideshare.net/QAware>SlideShare</a></li><li><a href=https://www.youtube.com/user/QAwareGmbH>YouTube</a></li><li><a href=https://www.meetup.com/de-DE/Cloud-Native-Night>Meetup Mainz</a></li><li><a href=https://www.meetup.com/de-DE/cloud-native-muc/>Meetup Munich</a></li></ul></li><li><a href=https://www.qaware.de class=nav-item>Company</a><ul><li><a href=https://www.qaware.de>Website</a></li><li><a href=https://twitter.com/qaware>Twitter</a></li><li><a href=http://www.linkedin.com/company/qaware-gmbh>Linkedin</a></li><li><a href=http://www.xing.com/companies/qawaregmbh>Xing</a></li><li><a href=http://www.kununu.com/qaware>Kununu</a></li></ul></li><li><a href=https://www.qaware.de/kontakt class=nav-item>Contact</a></li></ul></nav></div></header><main><div class='wrap mt-4 post'><div><p class='post_date pale'>22. October 2021</p><h1 class=post_title>Binary Data Format Comparison</h1><p class=pale>by <a href=https://github.com/g3force>Nicolai Ommer</a> | 1353 words | ~7 min read</p><p><a class=post_tag href=/tags/memory/>memory</a>
<a class=post_tag href=/tags/performance/>performance</a>
<a class=post_tag href=/tags/java/>java</a>
<a class=post_tag href=/tags/storage/>storage</a>
<a class=post_tag href=/tags/comparison/>comparison</a></p><div class=post_body><div class=post_inner><img src=https://blog.qaware.de/images/binary-data-format-comparison/title.jpg alt=binary-data-format-comparison/title.jpg class='post_thumbnail mt-1'><p>We recently had the requirement to store some medium-sized data (like 100 MB to 1 GB) in a file which should then be fully read into the heap by the application on startup.
So we analyzed different file formats in terms of size, read/write performance and overall handling and flexibility:</p><ul><li><a href=https://developers.google.com/protocol-buffers>Google Protobuf</a></li><li><a href=https://avro.apache.org/>Apache Avro</a></li><li><a href=https://parquet.apache.org/>Apache Parquet</a></li><li><a href=https://www.sqlite.org/index.html>SQLite</a></li><li>JSON with <a href=https://github.com/eclipse-ee4j/yasson>Yasson</a></li><li><a href=https://github.com/EsotericSoftware/kryo>Kryo</a></li><li><a href=https://microstream.one/>MicroStream</a></li></ul><p>The source code for this comparison can be found <a href=https://github.com/qaware/binary-data-format-comparison>on GitHub</a>.</p><h2 id=technical-differences-of-the-data-formats>Technical differences of the data-formats</h2><h3 id=protobuf>Protobuf</h3><p>Protobuf serializes entities as messages into a binary representation. There is no standard way to write a large set of messages into a file, but for some languages like Java, there are convenience methods to read and write messages delimited by their size. Compression can be done with data stream compression manually.</p><h3 id=avro>Avro</h3><p>Avro is similar to Protobuf, but also has build-in support for writing multiple entities into a file and handles separation itself.
It has several compression codecs built-in which can be set per file.
Java classes can be generated by Avro based on an Avro schema file and are natively supported by the Avro reader and writer implementations.
Alternatively, data can be stored in <a href=https://avro.apache.org/docs/current/api/java/org/apache/avro/generic/GenericRecord.html>GenericRecord</a>.
Both variants are included in the results below.</p><h3 id=parquet>Parquet</h3><p>Parquet is a columnar data format. It is mainly used inside the Hadoop universe, but is available as a separate library. It still depends on hadoop-common, so the dependency footprint is significantly larger than for all other formats.
It supports the schema definition files of Avro, natively supports storing multiple entities and has built-in compression which works on a per-column level, making compression very efficient.
The generated Java classes from Avro can be used as well as the GenericRecord. Additionally, Parquet allows to do the (de-)serialization without Avro. The <a href=https://javadoc.io/doc/org.apache.parquet/parquet-column/1.10.1/org/apache/parquet/example/data/Group.html>Group</a> class demonstrates this. It is included in the results as well.</p><h3 id=sqlite>SQLite</h3><p>SQLite is a well-known self-contained SQL database which is supported by many languages, including Java. It can basically be used by any database framework using JDBC. The whole database with all tables is stored in a single file.
For performance comparison, a database with a single table is used and all data is retrieved with a single select.</p><h3 id=json>JSON</h3><p>JSON is not a binary format and obviously not very efficient in terms of file size, but it is interesting to see how it compares with the other formats. Yasson, which is an implementation of JSON-B, is used here.
The entities have been written as new-line delimited JSON-stream.</p><h3 id=kryo>Kryo</h3><p>Kryo is an object graph serialization framework. It can serialize Java objects directly, but thus only supports Java and can not be used in other languages.</p><h3 id=microstream>MicroStream</h3><p>MicroStream is similar to Kryo. One notable advantage is that it supports immutable data classes (like Lomboks <code>@Value</code>). It writes data into a folder consisting of multiple files, while all other formats write into a single file.</p><h2 id=performance-measurement>Performance Measurement</h2><p>The data format performance was analyzed by generating a random set of data (10.000.000 entries), writing it with each format into a file and reading it back into the heap afterwards.
This was additionally done with gzip compression for each format.
The generated data contains a fixed amount of random strings (10.000) to make the effect of compression visible and more realistic.</p><p>The following metrics were taken for each storage solution:</p><ul><li>write time: Time to write the whole data set into a file</li><li>read time: Time to read the whole data set from a file into the heap</li><li>file size: memory usage on disk</li><li>heap after GC: heap usage after loading the whole data set into the heap (excluding intermediate data)</li></ul><h2 id=results>Results</h2><p>The file size per format is as follows:</p><figure><img src=/images/binary-data-format-comparison/file-size.png alt='Diagram of file size'><figcaption><p>Diagram of file size</p></figcaption></figure><p>Parquet is significantly smaller than the others. This is, because parquet will store duplicate strings much more efficient by de-duplicating the data. The additional gzip compression thus does not reduce the file size much further. The effect is much less significant when there is not so much duplication.
JSON is by far the largest one, as expected, but with compression the size is relatively similar to the others.</p><figure><img src=/images/binary-data-format-comparison/write-time.png alt='Diagram of write time'><figcaption><p>Diagram of write time</p></figcaption></figure><p>Looking at the write times, Avro and Kryo are by far the fastest ones when not compressing data, but compression takes a lot of extra time for all formats.
Compressing the SQLite DB even takes several minutes and is thus not shown in the diagram to keep it readable.</p><figure><img src=/images/binary-data-format-comparison/read-time.png alt='Diagram of read time'><figcaption><p>Diagram of read time</p></figcaption></figure><p>When reading the data back, Parquet is leading again, as long as data is directly mapped to the Avro-generated classes.
The example group provided by Parquet is very inefficient, both in reading performance and in heap usage.
The SQLite DB is slower than the others (except for JSON), as was expected, but it is a full database after all and thus provides other advantages, so it is worth considering it, if the performance overhead is acceptable.
Reading and parsing JSON takes 2-3 times more time than the other formats, which is also to be expected.</p><figure><img src=/images/binary-data-format-comparison/heap.png alt='Diagram of heap usage'><figcaption><p>Diagram of heap usage</p></figcaption></figure><p>The heap usage obviously depends on the entity class in the first place. The example group stores data redundantly and thus is twice as large as necessary.
The generic representation of Avro requires a bit more memory and the generated classes for Avro and Protobuf are similar.
The surprise is the data usage of Parquet. Due to the fact that it stores duplicate strings explicitly, it also loads each string only once into the heap.
The other formats always allocate new strings. This is a nice effect of the Parquet format, but could be mitigated by custom string pools or using <code>String#intern()</code>.</p><p>The full set of result metrics is shown in the following two tables:</p><table><thead><tr><th>format</th><th>write time [s]</th><th>file size [MB]</th></tr></thead><tbody><tr><td>parquet</td><td>15.326</td><td>276.40</td></tr><tr><td>parquet.gzip</td><td>20.151</td><td>275.26</td></tr><tr><td>avro</td><td>4.219</td><td>735.77</td></tr><tr><td>avro.gzip</td><td>20.776</td><td>646.44</td></tr><tr><td>proto</td><td>32.301</td><td>955.01</td></tr><tr><td>proto.gzip</td><td>53.36</td><td>735.77</td></tr><tr><td>sqlite</td><td>32.296</td><td>825.00</td></tr><tr><td>sqlite.gzip</td><td>523.713</td><td>665.55</td></tr><tr><td>json</td><td>29.169</td><td>1948.88</td></tr><tr><td>json.gzip</td><td>89.793</td><td>781.17</td></tr><tr><td>kryo</td><td>4.218</td><td>692.82</td></tr><tr><td>kryo.gzip</td><td>28.313</td><td>596.45</td></tr><tr><td>microStream</td><td>17.015</td><td>962.25</td></tr></tbody></table><table><thead><tr><th>format</th><th>class</th><th>read time [s]</th><th>heap usage [MB]</th></tr></thead><tbody><tr><td>group.parquet</td><td>SimpleGroup</td><td>15.686</td><td>9,965.98</td></tr><tr><td>group.parquet.gzip</td><td>SimpleGroup</td><td>14.289</td><td>9,965.99</td></tr><tr><td>gen.parquet</td><td>SampleDataAvro</td><td>6.495</td><td>582.86</td></tr><tr><td>gen.parquet.gzip</td><td>SampleDataAvro</td><td>6.663</td><td>582.86</td></tr><tr><td>avro</td><td>Record</td><td>9.356</td><td>4,446.56</td></tr><tr><td>avro.gzip</td><td>Record</td><td>11.819</td><td>4,446.54</td></tr><tr><td>gen.avro</td><td>SampleDataAvro</td><td>8.494</td><td>3,014.56</td></tr><tr><td>gen.avro.gzip</td><td>SampleDataAvro</td><td>12.11</td><td>3,014.53</td></tr><tr><td>proto</td><td>SampleDataPb</td><td>10.57</td><td>3,167.13</td></tr><tr><td>proto.gzip</td><td>SampleDataPb</td><td>18.374</td><td>3,167.13</td></tr><tr><td>sqlite</td><td>SampleDataAvro</td><td>28.578</td><td>3,112.41</td></tr><tr><td>json</td><td>SampleDataJson</td><td>44.899</td><td>3,073.29</td></tr><tr><td>json.gzip</td><td>SampleDataJson</td><td>53.56</td><td>3,073.30</td></tr><tr><td>kryo</td><td>SampleDataKryo</td><td>10.887</td><td>3,014.62</td></tr><tr><td>kryo.gzip</td><td>SampleDataKryo</td><td>7.819</td><td>3,014.62</td></tr><tr><td>microStream</td><td>SampleDataMicroStream</td><td>15.338</td><td>576.06</td></tr></tbody></table><h2 id=summary>Summary</h2><p>The analysis showed some interesting metrics of the different formats.
Parquet is a very efficient data format, but comes with a lot of dependencies and thus extra complexity. It is also less common and available tools are sparse.
Avro and Protobuf are very similar, but Avro has more features in terms of writing multiple rows and overall showed better performance when working with larger data sets.
SQLite, given it is a full SQL database, compares pretty well against the other optimized binary data formats. If you consider reading only parts of the data, consider using such a database to get more flexibility.
Kryo is very efficient and especially useful if data is only accessed by a single Java application. The main downside is the absence of a language-independent data schema.
MicroStream is similar to Kryo, but significantly slower. On the other hand, it can even (de-)serialize immutable classes.</p><p>There is no perfect data format. It always depends on your use-case, but the comparison should help to point you to the right direction for your individual use-case.</p><p>In our case, we initially started with Parquet, but then moved to SQLite after the analysis. We wanted to get rid of the large dependency tree that included several dependencies with security issues raised during the OWASP analysis. Additionally, using a database gives us more common and powerful tools for reading and linking the data entities. For these advantages we accepted the larger file size.</p><p>Note that all the metrics depend a lot on the actual data, so if you want to find the best data format for your use case, clone the GitHub project and run the benchmark with your own data model.</p></div><div class='post_extra mb-2'><div class='share copy'></div><a href="http://twitter.com/share?text=Check out this post on the QAware Engineering Blog about Binary%20Data%20Format%20Comparison&url=https%3a%2f%2fblog.qaware.de%2fposts%2fbinary-data-format-comparison%2f&hashtags=Memory%2cPerformance%2cJava%2cStorage%2cComparison"><div class='share twitter'></div></a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3a%2f%2fblog.qaware.de%2fposts%2fbinary-data-format-comparison%2f"><div class='share linkedin'></div></a><a href="mailto:?subject=Binary%20Data%20Format%20Comparison&amp;body=Hi,%0D%0A%0D%0ACheck out this post on the QAware Engineering Blog: https%3a%2f%2fblog.qaware.de%2fposts%2fbinary-data-format-comparison%2f%0D%0A%0D%0ABest Regards"><div class='share email'></div></a></div><div></div></div></div></div><a href=https://blog.qaware.de/ class=post_nav><span class=post_next>The Latest Posts</span></a></main><footer><div class=footer-container><div class=short-link-area><div class=margin><div class=logo-qaware><a href=/><img src=/images/icons/logo-qaware-white.png alt=QAware width=195 height=43></a></div><div class=clr></div><div class=footer-links><a href=https://www.qaware.de/newsbereich/ class=foot-single-link>News</a>
<a href=https://www.qaware.de/eventkalender/ class=foot-single-link>Eventkalender</a>
<a href=https://www.qaware.de/kontakt/ class=foot-single-link>Kontakt</a><div class=footer-table><a href=https://info.qaware.de/en/legal-notice class="foot-single-link footer-table-cell">Legal Notice</a>&nbsp;|&nbsp;
<a href=https://info.qaware.de/en/legal-notice class="foot-single-link footer-table-cell">Privacy</a></div></div><nav class=nav-social><ul class=e-social id=c1375><li><a href=http://www.kununu.com/qaware title=Kununu target=_blank class="icon icon-kununu-outline"><span></span></a></li><li><a href=https://www.twitter.com/qaware title=Twitter target=_blank class="icon icon-twitter-outline"><span></span></a></li><li><a href=https://www.linkedin.com/company/qaware-gmbh title=LinkedIn target=_blank class="icon icon-linkedin-outline"><span></span></a></li><li><a href=https://github.com/qaware title=GitHub target=_blank class="icon icon-git-outline"><span></span></a></li><li><a href=https://www.slideshare.net/qaware title=SlideShare target=_blank class="icon icon-slideshare-outline"><span></span></a></li><li><a href=https://www.youtube.com/channel/UCmNf72xADnO57idipq9jvMg title=Youtube target=_blank class="icon icon-youtube-outline"><span></span></a></li></ul></nav><div class=clr></div></div></div><nav class="footer-nav nav-area"><ul class=margin><li><a href=https://www.qaware.de/leistung/>Leistung</a><ul><li><a href=https://www.qaware.de/leistung/#diagnose>Diagnose</a></li><li><a href=https://www.qaware.de/leistung/#sanierung>Sanierung</a></li><li><a href=https://www.qaware.de/leistung/#leistung-exploration>Exploration</a></li><li><a href=https://www.qaware.de/leistung/#leistung-realisierung>Realisierung</a></li><li><a href=https://www.qaware.de/leistung/#kunden>Referenzen</a></li></ul></li><li><a href=https://www.qaware.de/karriere/>Karriere</a><ul><li><a href=https://www.qaware.de/karriere/#arbeitsplatz>Arbeitsplatz</a></li><li><a href=https://www.qaware.de/karriere/#kultur>Kultur</a></li><li><a href=https://www.qaware.de/karriere/#entwicklung>Entwicklung</a></li><li><a href=https://www.qaware.de/karriere/#weiterbildung>Weiterbildung</a></li><li><a href=https://www.qaware.de/karriere/#jobs>Jobs</a></li><li><a href=https://www.qaware.de/karriere/#veranstaltungen>Veranstaltungen</a></li></ul></li><li><a href=https://www.qaware.de/wissen/>Wissen</a><ul><li><a href=https://www.qaware.de/wissen/#manifest>Manifest</a></li><li><a href=https://www.qaware.de/wissen/#blog>Blog</a></li><li><a href=https://www.qaware.de/wissen/#konferenzen>Konferenzen</a></li><li><a href=https://www.qaware.de/wissen/#fachartikel>Fachartikel</a></li><li><a href=https://www.qaware.de/wissen/#buecher>Bücher</a></li><li><a href=https://www.qaware.de/wissen/#vorlesungen>Vorlesungen</a></li><li><a href=https://www.qaware.de/wissen/#forschung>Forschung</a></li></ul></li><li><a href=https://www.qaware.de/unternehmen/>Unternehmen</a><ul><li><a href=https://www.qaware.de/unternehmen/#unternehmenskultur>Mission</a></li><li><a href=https://www.qaware.de/unternehmen/#kennzahlen>Kennzahlen</a></li><li><a href=https://www.qaware.de/unternehmen/#management>Management</a></li></ul></li></ul></nav></div></footer><script src=https://blog.qaware.de/js/index.min.791bb653c336adab277d58e8a52b9e81250276bb14f8fced435ae89f02d3155ae233664425075d8cb7ef5444d08a4a2276ee6bf16082d57c12c85f010e25412a.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-45534590-1"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-45534590-1")</script></body></html>