<!doctype html><html lang=en><head><title>How to develop Eclipse SmartHome Bindings with IntelliJ and Docker - QAware | Software Engineering Blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=yes"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=description content="We show you our approach on how to develop Eclipse SmartHome bindings with IntelliJ And Docker."><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="How to develop Eclipse SmartHome Bindings with IntelliJ and Docker"><meta property="og:description" content="We show you our approach on how to develop Eclipse SmartHome bindings with IntelliJ And Docker."><meta property="og:url" content="https://blog.qaware.de/posts/eclipse-smart-home-bindings/"><meta property="og:image" content="https://blog.qaware.de/images/images/qaware_logo.png"><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><link rel=apple-touch-icon sizes=57x57 href=/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=icon href=/QAware_Logo_Icon_RGB_Petrol.svg type=image/svg+xml><meta name=msapplication-TileColor content="#ffffff"><meta name=msapplication-TileImage content="/ms-icon-144x144.png"><meta name=theme-color content="#ffffff"><link rel=canonical href=https://blog.qaware.de/posts/eclipse-smart-home-bindings/><link rel=stylesheet href=https://blog.qaware.de/css/main.098c0e189cad2e9f36cf297e63d68287a9f1e1ba37b72c316aafe78722aca094738d3238a359d91fca3eb48fc356b73c7e436c50fac13d61ddfa699fca90005d.css integrity='sha512-CYwOGJytLp82zyl+Y9aCh6nx4bo3tywxaq/nhyKsoJRzjTI4o1nZH8o+tI/DVrc8fkNsUPrBPWHd+mmfypAAXQ==' title=templateStyle><script id=Cookiebot src=https://consent.cookiebot.com/uc.js data-cbid=4e938949-aa56-465e-9c2a-175bb6c31d81 data-blockingmode=auto type=text/javascript></script></head><body><header><div id=main-header><a href=/ id=main-header-logo><img src=/images/icons/logo_qaware.svg alt=QAware id=main-header-logo-img></a><div id=main-header-nav-items-container><nav id=main-nav><ul class=main-nav-menu><li class=main-nav-menu><a href=https://blog.qaware.de/ class="main-nav-menu nav-item">Posts</a><ul class=main-nav-sub-menu><li class=main-nav-sub-menu><a href=https://blog.qaware.de/tags/ class="main-nav-sub-menu nav-item">Tags</a></li><li class=main-nav-sub-menu><a href=https://blog.qaware.de/posts/ class="main-nav-sub-menu nav-item">Archive</a></li></ul></li><li class=main-nav-menu><a href=https://blog.qaware.de/ class="main-nav-menu nav-item">Resources</a><ul class=main-nav-sub-menu><li class=main-nav-sub-menu><a href=https://www.github.com/qaware class=main-nav-sub-menu>GitHub</a></li><li class=main-nav-sub-menu><a href=https://de.slideshare.net/QAware class=main-nav-sub-menu>SlideShare</a></li><li class=main-nav-sub-menu><a href=https://www.youtube.com/user/QAwareGmbH class=main-nav-sub-menu>YouTube</a></li><li class=main-nav-sub-menu><a href=https://www.meetup.com/de-DE/Cloud-Native-Night class=main-nav-sub-menu>Meetup Mainz</a></li><li class=main-nav-sub-menu><a href=https://www.meetup.com/de-DE/cloud-native-muc/ class=main-nav-sub-menu>Meetup Munich</a></li></ul></li><li class=main-nav-menu><a href=https://www.qaware.de class=main-nav-menu>Company</a><ul class=main-nav-sub-menu><li class=main-nav-sub-menu><a href=https://www.qaware.de class=main-nav-sub-menu>Website</a></li><li class=main-nav-sub-menu><a href=https://twitter.com/qaware class=main-nav-sub-menu>Twitter</a></li><li class=main-nav-sub-menu><a href=http://www.linkedin.com/company/qaware-gmbh class=main-nav-sub-menu>Linkedin</a></li><li class=main-nav-sub-menu><a href=http://www.xing.com/companies/qawaregmbh class=main-nav-sub-menu>Xing</a></li><li class=main-nav-sub-menu><a href=http://www.kununu.com/qaware class=main-nav-sub-menu>Kununu</a></li></ul></li><li class=main-nav-menu><a href=https://www.qaware.de/kontakt class=main-nav-menu>Contact</a></li></ul></nav><a id=mobile-nav-icon-link href=#><div id=mobile-nav-icon></div></a></div></div><div id=mobile-nav-dropdown><nav id=mobile-nav class="mobile-nav collapsed"><ul><li><a href=https://blog.qaware.de/ class=nav-item>Posts</a><ul><li><a href=https://blog.qaware.de/tags/ class=nav-item>Tags</a></li><li><a href=https://blog.qaware.de/posts/ class=nav-item>Archive</a></li></ul></li><li><a href=https://blog.qaware.de/ class=nav-item>Resources</a><ul><li><a href=https://www.github.com/qaware>GitHub</a></li><li><a href=https://de.slideshare.net/QAware>SlideShare</a></li><li><a href=https://www.youtube.com/user/QAwareGmbH>YouTube</a></li><li><a href=https://www.meetup.com/de-DE/Cloud-Native-Night>Meetup Mainz</a></li><li><a href=https://www.meetup.com/de-DE/cloud-native-muc/>Meetup Munich</a></li></ul></li><li><a href=https://www.qaware.de class=nav-item>Company</a><ul><li><a href=https://www.qaware.de>Website</a></li><li><a href=https://twitter.com/qaware>Twitter</a></li><li><a href=http://www.linkedin.com/company/qaware-gmbh>Linkedin</a></li><li><a href=http://www.xing.com/companies/qawaregmbh>Xing</a></li><li><a href=http://www.kununu.com/qaware>Kununu</a></li></ul></li><li><a href=https://www.qaware.de/kontakt class=nav-item>Contact</a></li></ul></nav></div></header><main><div class='wrap mt-4 post'><div><p class='post_date pale'>20. September 2017</p><h1 class=post_title>How to develop Eclipse SmartHome Bindings with IntelliJ and Docker</h1><p class=pale>by Moritz Kammerer | 732 words | ~4 min read</p><p><a class=post_tag href=/tags/smarthome/>smarthome</a>
<a class=post_tag href=/tags/eclipse/>eclipse</a>
<a class=post_tag href=/tags/java/>java</a>
<a class=post_tag href=/tags/home-automation/>home automation</a>
<a class=post_tag href=/tags/iot/>iot</a>
<a class=post_tag href=/tags/intellij/>intellij</a>
<a class=post_tag href=/tags/docker/>docker</a></p><div class=post_body><div class=post_inner><p>Developing the Eclipse SmartHome (ESH) bindings with another IDE than Eclipse is difficult because the standard way of developing the bindings requires the tools provided by the Eclipse IDE. One can develop the ESH bindings with IntelliJ, however a crucial question remains open: how to test the developed bindings without having the Eclipse tools at hand?
Using IntelliJ to develop the ESH bindings is different to using Eclipse for two main reasons:</p><ul><li><strong>First</strong>: Eclipse uses a “manifest first” approach while the Java standard approach is “POM first” with a handwritten or generated manifest. In our example we have used a handwritten manifest.</li><li><strong>Second</strong>: To debug and test in Eclipse, it is enough start the full environment using the target platform provided by ESH. This starts a JVM with equinox as a local process. To debug and test in IntelliJ, one should copy the binding jar built by MAVEN into a prepared Docker container and then start it.</li></ul><h2 id=minimal-eclipse-smarthome-for-testing-bindings-in-intellij>Minimal Eclipse SmartHome for testing bindings in IntelliJ</h2><p>Our approach is based on the <a href=https://github.com/eclipse/smarthome-packaging-sample>packaging example</a> of ESH in combination with <a href=http://www.eclipse.org/concierge/>Eclipse Concierge</a> as OSGi Container.
A full MAVEN build with mvn clean package creates a new zip file within the /target directory. This zip file contains a full OSGi container, the Eclipse SmartHome basics, the Yahoo Weather Binding and an addons directory. The OSGi container scans the addons directory for bundles and deploys them automatically. This zip file can be used to create a Docker container.
In order to stop the container gracefully a small change in the start script is needed. A description of it can be found here: <a href=https://github.com/qaware/smarthome-packaging-sample>qaware/smarthome-packaging-sample</a>.</p><p>We have updated and added some dependencies to the original repository. One of the updated dependencies is the Jetty webserver, which also includes its client in the latest version of the 9.3.x branch.</p><h2 id=the-docker-container>The Docker Container</h2><p><em>All the following examples and commands are based on the <a href=https://github.com/qaware/smarthome-packaging-sample>qaware/smarthome-packaging-sample</a> repository.</em></p><p>The Dockerfile creates an image which is runnable out of the box. It contains a full Eclipse SmartHome, which runs on an Alpine Linux with the current OpenJDK 8 Runtime Environment. The image has a final size of less than 140 MB.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-docker data-lang=docker><span class=line><span class=cl><span class=k>FROM</span><span class=s> openjdk:8-jre-alpine</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span> <span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> <span class=nv>DEBUG_PORT</span><span class=o>=</span><span class=m>5005</span> <span class=nv>HTTPS_PORT</span><span class=o>=</span><span class=m>8443</span> <span class=nv>HTTP_PORT</span><span class=o>=</span><span class=m>8080</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=k>WORKDIR</span><span class=s> /opt/esh/runtime/concierge</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ADD</span> /target/smarthome-packaging-sample-*.zip /tmp/<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> apk add --update unzip <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span> <span class=o>&amp;&amp;</span> mkdir -p /opt/esh/conf/services <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span> <span class=o>&amp;&amp;</span> unzip /tmp/smarthome-packaging-sample-*.zip -d /opt/esh <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span> <span class=o>&amp;&amp;</span> chmod +x /opt/esh/runtime/concierge/start.sh <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span> <span class=o>&amp;&amp;</span> rm -f /tmp/smarthome-packaging-sample-*.zip <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span> <span class=o>&amp;&amp;</span> apk del wget <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span> <span class=o>&amp;&amp;</span> rm -rf /var/cache/apk/*<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> 5005 8080</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENTRYPOINT</span> <span class=nb>exec</span> /opt/esh/runtime/concierge/start.sh<span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>You can find the Dockerfile within the forked repository.
To build and tag the container as <code>eclipse/smarthome:latest</code>, you need to run:
<code>./mvnw clean package && docker build . -t eclipse/smarthome:latest</code>
Now it is possible to start the container:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -dit <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -p 127.0.0.1:8080:8080 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  eclipse/smarthome:latest
</span></span></code></pre></td></tr></table></div></div><p>You can subsequently open the <a href=http://127.0.0.1:8080/>PaperUI</a> and the <a href=http://admin:admin@127.0.0.1:8080/system/console>System Console</a> (username & password: admin).
The container can also be started in debug mode, which allows connecting an external debugger to the container. To start the container in debug mode use this command:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -dit <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -p 127.0.0.1:8080:8080 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -p 127.0.0.1:5005:5005 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=s2>&#34;REMOTE_DEBUG=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  eclipse/smarthome:latest
</span></span></code></pre></td></tr></table></div></div><p>You can now connect the container with a Java debugger (like IntelliJ) using the address <code>127.0.0.1:5005</code>.</p><h2 id=run-and-debug-an-eclipse-smarthome-binding-within-the-docker-container>Run and Debug an Eclipse SmartHome Binding within the Docker container</h2><p>This part builds upon our previous blog post about the usage of Docker and IntelliJ: How to use Docker within IntelliJ
You can use the previously created Docker image for the development of bindings. To do that you need another small Dockerfile which copies the binding into /opt/esh/addons/ of the container:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-docker data-lang=docker><span class=line><span class=cl><span class=k>FROM</span><span class=s> eclipse/smarthome</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># replaces org.eclipse.smarthome.binding.hue with your binding id</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ADD</span> target/org.eclipse.smarthome.binding.hue-*.jar /opt/esh/addons<span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>You can place this Dockerfile into the main directory of the bundle, next to the MAVEN pom.xml, and subsequently use it for a new Docker deployment in IntelliJ as described in How to use Docker within IntelliJ. In IntelliJ you can directly start the Docker deployment with an attached debugger. Alternatively, you can create a volume mount to /opt/esh/addons and, after the successful completion of the build, copy the binding jar into the mount.</p><h2 id=recommended-volume-mount>Recommended Volume Mount</h2><p>We recommend to mount a volume into the Docker container to store the information about the bindings and the other configurations of the ESH: <code>/opt/esh/userdata</code></p></div><div class='post_extra mb-2'><div class='share copy'></div><a href="http://twitter.com/share?text=Check out this post on the QAware Engineering Blog about How%20to%20develop%20Eclipse%20SmartHome%20Bindings%20with%20IntelliJ%20and%20Docker&url=https%3a%2f%2fblog.qaware.de%2fposts%2feclipse-smart-home-bindings%2f&hashtags=SmartHome%2cEclipse%2cJava%2cHomeAutomation%2cIoT%2cIntelliJ%2cDocker"><div class='share twitter'></div></a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3a%2f%2fblog.qaware.de%2fposts%2feclipse-smart-home-bindings%2f"><div class='share linkedin'></div></a><a href="mailto:?subject=How%20to%20develop%20Eclipse%20SmartHome%20Bindings%20with%20IntelliJ%20and%20Docker&body=Hi,%0D%0A%0D%0ACheck out this post on the QAware Engineering Blog: https%3a%2f%2fblog.qaware.de%2fposts%2feclipse-smart-home-bindings%2f%0D%0A%0D%0ABest Regards"><div class='share email'></div></a></div><div></div></div></div></div><a href=https://blog.qaware.de/ class=post_nav><span class=post_next>The Latest Posts</span></a></main><footer><div class=footer-container><div class=short-link-area><div class=margin><div class=logo-qaware><a href=/><img src=/images/icons/logo-qaware-white.png alt=QAware width=195 height=43></a></div><div class=clr></div><div class=footer-links><a href=https://www.qaware.de/newsbereich/ class=foot-single-link>News</a>
<a href=https://www.qaware.de/eventkalender/ class=foot-single-link>Eventkalender</a>
<a href=https://www.qaware.de/kontakt/ class=foot-single-link>Kontakt</a><div class=footer-table><a href=https://info.qaware.de/en/legal-notice class="foot-single-link footer-table-cell">Legal Notice</a>&nbsp;|&nbsp;
<a href=https://info.qaware.de/en/legal-notice class="foot-single-link footer-table-cell">Privacy</a></div></div><nav class=nav-social><ul class=e-social id=c1375><li><a href=http://www.kununu.com/qaware title=Kununu target=_blank class="icon icon-kununu-outline"><span></span></a></li><li><a href=https://www.twitter.com/qaware title=Twitter target=_blank class="icon icon-twitter-outline"><span></span></a></li><li><a href=https://www.linkedin.com/company/qaware-gmbh title=LinkedIn target=_blank class="icon icon-linkedin-outline"><span></span></a></li><li><a href=https://github.com/qaware title=GitHub target=_blank class="icon icon-git-outline"><span></span></a></li><li><a href=https://www.slideshare.net/qaware title=SlideShare target=_blank class="icon icon-slideshare-outline"><span></span></a></li><li><a href=https://www.youtube.com/channel/UCmNf72xADnO57idipq9jvMg title=Youtube target=_blank class="icon icon-youtube-outline"><span></span></a></li></ul></nav><div class=clr></div></div></div><nav class="footer-nav nav-area"><ul class=margin><li><a href=https://www.qaware.de/leistung/>Leistung</a><ul><li><a href=https://www.qaware.de/leistung/#diagnose>Diagnose</a></li><li><a href=https://www.qaware.de/leistung/#sanierung>Sanierung</a></li><li><a href=https://www.qaware.de/leistung/#leistung-exploration>Exploration</a></li><li><a href=https://www.qaware.de/leistung/#leistung-realisierung>Realisierung</a></li><li><a href=https://www.qaware.de/leistung/#kunden>Referenzen</a></li></ul></li><li><a href=https://www.qaware.de/karriere/>Karriere</a><ul><li><a href=https://www.qaware.de/karriere/#arbeitsplatz>Arbeitsplatz</a></li><li><a href=https://www.qaware.de/karriere/#kultur>Kultur</a></li><li><a href=https://www.qaware.de/karriere/#entwicklung>Entwicklung</a></li><li><a href=https://www.qaware.de/karriere/#weiterbildung>Weiterbildung</a></li><li><a href=https://www.qaware.de/karriere/#jobs>Jobs</a></li><li><a href=https://www.qaware.de/karriere/#veranstaltungen>Veranstaltungen</a></li></ul></li><li><a href=https://www.qaware.de/wissen/>Wissen</a><ul><li><a href=https://www.qaware.de/wissen/#manifest>Manifest</a></li><li><a href=https://www.qaware.de/wissen/#blog>Blog</a></li><li><a href=https://www.qaware.de/wissen/#konferenzen>Konferenzen</a></li><li><a href=https://www.qaware.de/wissen/#fachartikel>Fachartikel</a></li><li><a href=https://www.qaware.de/wissen/#buecher>Bücher</a></li><li><a href=https://www.qaware.de/wissen/#vorlesungen>Vorlesungen</a></li><li><a href=https://www.qaware.de/wissen/#forschung>Forschung</a></li></ul></li><li><a href=https://www.qaware.de/unternehmen/>Unternehmen</a><ul><li><a href=https://www.qaware.de/unternehmen/#unternehmenskultur>Mission</a></li><li><a href=https://www.qaware.de/unternehmen/#kennzahlen>Kennzahlen</a></li><li><a href=https://www.qaware.de/unternehmen/#management>Management</a></li></ul></li></ul></nav></div></footer><script src=https://blog.qaware.de/js/index.min.791bb653c336adab277d58e8a52b9e81250276bb14f8fced435ae89f02d3155ae233664425075d8cb7ef5444d08a4a2276ee6bf16082d57c12c85f010e25412a.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-538827-3"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-538827-3")</script></body></html>